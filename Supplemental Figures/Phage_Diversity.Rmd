---
title: "Phage Diverity"
author: "Alisha Monsibais"
date: '2024-10-08'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Project Summary: 

This project is to address the reviwer comment:

Reviewer 3: 1.a. Relative diversity of the recovered phage from a single environment for Sm compared to panning for phage of other species? Are Sm phages more rare than other phage? Less diverse per phage hit?

Meeting with Amit (10/8/24
He ran his pipeline using a Phage panel for NCBI. Output includes tax.json files and .json file
-tax.json files are human readable files that have the virus/phage name and the relative abundance
-.json files have the NCBI # and relative abundance

Goals
1. Pull all the Escondido information associated with phage in the line
2. Data wrangling in r
3. Relative Abundance per sample per host bacteria
4. Shannon Diversisty per sample per host bacteria

Questions
1. Are S. maltophilia phages more rare than phages for other bacterial species? (relative abundance)
2. Is the diversity of S. maltophilia phages lower than that of phages for other species? (shannon diversity)
3. Do individual S. maltophilia phage isolates (per phage hit) exhibit less diversity compared to phages for other species?
   - hard to answer - phages were collected by multiple people over a period of time


```{r importing data}
data <- read.csv("Phage_ESC.txt", sep =":", header = FALSE)
```


```{r}
library(dplyr)
library(tidyr)
library(ggplot2)
library(stringr)
```


## Data Wrangling

```{r Data Wrangling, echo=FALSE}

clean_data <- data %>%
  rename("Sample_Name" = V1, "Phage" = V2, "Relative_Abundance" = V3) %>%
  mutate(Relative_Abundance = as.numeric(gsub("[ ,]", "", Relative_Abundance))) %>%
  separate(Sample_Name, 
           into = c("Location", "Month", "Day", "Year", "Treatment", "Other"), 
           sep = "_|\\.", 
           remove = FALSE) %>%
   separate(Phage, 
           into = c("1", "2", "Host", "4", "Phage_Info"), 
           sep = " ", 
           remove = FALSE) %>%
  select(Sample_Name, Month, Day, Year, Treatment, Phage, Host, Phage_Info, Relative_Abundance)
str(clean_data)
```


```{r relative abundance}

summary_df <- clean_data %>%
  group_by(Host) %>%
  summarise(Total_Abundance = sum(Relative_Abundance, na.rm = TRUE)) %>%
  ungroup()
  
summary_df <- clean_data %>%
  mutate(Host = ifelse(Host == "Uncultured", "uncultured", Host)) %>%  # Change "Uncultured" to "uncultured"
  group_by(Host) %>%
  summarise(Total_Abundance = sum(Relative_Abundance, na.rm = TRUE)) %>%
  ungroup()

library(forcats)

ggplot(summary_df, aes(x = fct_reorder(Host, Total_Abundance, .desc = TRUE), y = Total_Abundance)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = NULL, y = "Total Relative Abundance", title = "Relative Abundance of Phage by Host", subtitle = "Oct 2020 to Sept 2021") +
  theme_linedraw() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5),  # Center the title
    plot.subtitle = element_text(hjust = 0.5)
  )


host <- unique(summary_df$Host)


print(host)

```





